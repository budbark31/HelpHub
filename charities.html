<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HelpHub - Charities</title>
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/charities.css">
  <script src="js/auth.js" defer></script>
  <script src="js/charities.js" defer></script>
</head>
<body>
  <header>
    <div class="logo">HelpHub</div>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="charities.html">Charities</a></li>
        <li><a href="about.html">About</a></li>
      </ul>
    </nav>
    <div class="auth-buttons">
      <button onclick="location.href='signup.html'">Sign Up</button>
      <button onclick="location.href='login.html'">Login</button>
    </div>
  </header>
  <main>
    <section class="hero" aria-labelledby="explore-charities-heading">
      <h1 id="explore-charities-heading">Explore Charities</h1>
      <p>Discover organizations making a difference in your community and beyond.</p>
      <form id="charity-search-form" role="search" aria-label="Charity search and filter">
        <input type="text" id="charity-search" placeholder="Find a charity" aria-label="Search charities by name or description" />
        <select id="filter-cause" aria-label="Filter by cause">
          <option value="">All Causes</option>
          <option value="Education">Education</option>
          <option value="Environment">Environment</option>
          <option value="Hunger Relief">Hunger Relief</option>
          <option value="Medical Aid">Medical Aid</option>
          <option value="Housing">Housing</option>
          <option value="Arts">Arts</option>
          <option value="Community">Community</option>
          <option value="Youth Empowerment">Youth Empowerment</option>
          <!-- Add more as needed -->
        </select>
        <select id="filter-location" aria-label="Filter by location">
          <option value="">All Locations</option>
          <option value="Nationwide">Nationwide</option>
          <option value="Midwest">Midwest</option>
          <option value="Urban Centers">Urban Centers</option>
          <option value="Global">Global</option>
          <option value="Southeast">Southeast</option>
          <!-- Add more as needed -->
        </select>
      </form>
      <div id="realtime-stats" style="margin-top:20px;font-size:1.1em;color:#4a7c59;"></div>
    </section>
    <section class="charity-grid" aria-live="polite">
      <div class="charity-box" data-charity="brightfutures" tabindex="0" aria-label="Bright Futures Fund charity card">
        <img src="Images\BrightFuturesFund.jpg" alt="Bright Futures Fund" />
        <h3>Bright Futures Fund</h3>
        <p>Helping children reach for the stars through education.</p>
        <div class="charity-hover-details" style="display:none;">
          <strong>Founded:</strong> 2012<br>
          <strong>Scholarships awarded:</strong> 2,300+<br>
          <strong>Location:</strong> Nationwide<br>
          <strong>Focus:</strong> Education, Mentorship
        </div>
        <a href="charity1_profile.html">View Profile</a>
        <button class="review-btn" data-charity="brightfutures" aria-label="Read and write reviews for Bright Futures Fund" tabindex="0">Reviews</button>
      </div>
      <div class="charity-box" data-charity="greenhaven" tabindex="0" aria-label="Green Haven Initiative charity card">
        <img src="Images\GreenHavenInstitute.jpg" alt="Green Haven Initiative" />
        <h3>Green Haven Initiative</h3>
        <p>Bringing our planet back to life, one tree at a time.</p>
        <div class="charity-hover-details" style="display:none;">
          <strong>Founded:</strong> 2015<br>
          <strong>Trees Planted:</strong> 120,000+<br>
          <strong>Location:</strong> Midwest<br>
          <strong>Focus:</strong> Environment, Reforestation
        </div>
        <a href="charity2_profile.html">View Profile</a>
        <button class="review-btn" data-charity="greenhaven" aria-label="Read and write reviews for Green Haven Initiative" tabindex="0">Reviews</button>
      </div>
      <div class="charity-box" data-charity="hopekitchen" tabindex="0" aria-label="Hope Kitchen Network charity card">
        <img src="Images\HopeKitchenNetwork.jpg" alt="Hope Kitchen Network" />
        <h3>Hope Kitchen Network</h3>
        <p>Serving meals with dignity and a side of compassion.</p>
        <div class="charity-hover-details" style="display:none;">
          <strong>Founded:</strong> 2008<br>
          <strong>Meals Served:</strong> 1,000,000+<br>
          <strong>Location:</strong> Urban Centers<br>
          <strong>Focus:</strong> Hunger Relief, Community
        </div>
        <a href="charity3_profile.html">View Profile</a>
        <button class="review-btn" data-charity="hopekitchen" aria-label="Read and write reviews for Hope Kitchen Network" tabindex="0">Reviews</button>
      </div>
      <div class="charity-box" data-charity="healinghands" tabindex="0" aria-label="Healing Hands Aid charity card">
        <img src="Images\HealingHandsAid.jpg" alt="Healing Hands Aid" />
        <h3>Healing Hands Aid</h3>
        <p>Bringing heartfelt medical care to those who need it most.</p>
        <div class="charity-hover-details" style="display:none;">
          <strong>Founded:</strong> 2010<br>
          <strong>Patients Helped:</strong> 75,000+<br>
          <strong>Location:</strong> Global<br>
          <strong>Focus:</strong> Medical Aid, Disaster Relief
        </div>
        <a href="charity4_profile.html">View Profile</a>
        <button class="review-btn" data-charity="healinghands" aria-label="Read and write reviews for Healing Hands Aid" tabindex="0">Reviews</button>
      </div>
      <div class="charity-box" data-charity="unityhomes" tabindex="0" aria-label="Unity Homes Project charity card">
        <img src="Images\UnityHomes.jpg" alt="Unity Homes Project" />
        <h3>Unity Homes Project</h3>
        <p>Creating spaces where families and dreams can grow.</p>
        <div class="charity-hover-details" style="display:none;">
          <strong>Founded:</strong> 2014<br>
          <strong>Homes Built:</strong> 600+<br>
          <strong>Location:</strong> Southeast<br>
          <strong>Focus:</strong> Housing, Community
        </div>
        <a href="charity5_profile.html">View Profile</a>
        <button class="review-btn" data-charity="unityhomes" aria-label="Read and write reviews for Unity Homes Project" tabindex="0">Reviews</button>
      </div>
      <div class="charity-box" data-charity="creativeminds" tabindex="0" aria-label="Creative Minds Collective charity card">
        <img src="Images\CreativeMinds.jpg" alt="Creative Minds Collective" />
        <h3>Creative Minds Collective</h3>
        <p>Unlocking imagination and potential through the arts.</p>
        <div class="charity-hover-details" style="display:none;">
          <strong>Founded:</strong> 2017<br>
          <strong>Students Reached:</strong> 8,500+<br>
          <strong>Location:</strong> Nationwide<br>
          <strong>Focus:</strong> Arts, Youth Empowerment
        </div>
        <a href="charity6_profile.html">View Profile</a>
        <button class="review-btn" data-charity="creativeminds" aria-label="Read and write reviews for Creative Minds Collective" tabindex="0">Reviews</button>
      </div>
    </section>
    <!-- Reviews Modal -->
    <div id="reviews-modal" role="dialog" aria-modal="true" aria-labelledby="reviews-modal-title" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;z-index:9999;">
      <div style="background:#fff;max-width:420px;width:95%;padding:24px 18px 18px 18px;border-radius:8px;position:relative;">
        <button id="close-reviews-modal" aria-label="Close reviews dialog" style="position:absolute;top:10px;right:10px;background:none;border:none;font-size:1.5em;cursor:pointer;">&times;</button>
        <h2 id="reviews-modal-title" style="margin-top:0;">Charity Reviews</h2>
        <div id="reviews-list" style="max-height:220px;overflow-y:auto;margin-bottom:12px;"></div>
        <form id="review-form" autocomplete="off">
          <label for="review-rating">Your Rating:</label>
          <select id="review-rating" required aria-label="Rating">
            <option value="">Select</option>
            <option value="5">★★★★★</option>
            <option value="4">★★★★☆</option>
            <option value="3">★★★☆☆</option>
            <option value="2">★★☆☆☆</option>
            <option value="1">★☆☆☆☆</option>
          </select>
          <label for="review-text">Your Review:</label>
          <textarea id="review-text" rows="2" maxlength="300" required aria-label="Write your review"></textarea>
          <button type="submit" style="margin-top:8px;">Submit Review</button>
        </form>
      </div>
    </div>
  </main>
  <footer>
    <div class="logo">
      <p>HelpHub</p>
      <p>123 Charity Ave<br />Nonprofit City, NP 12345</p>
    </div>
    <div class="social-links">
      <a href="#">Facebook</a>
      <a href="#">Twitter</a>
      <a href="#">Instagram</a>
      <a href="#">LinkedIn</a>
    </div>
  </footer>
  <script>
    // Hover details logic
    document.querySelectorAll('.charity-box').forEach(box => {
      box.addEventListener('mouseenter', function() {
        this.querySelector('.charity-hover-details').style.display = 'block';
        this.style.boxShadow = '0 8px 24px rgba(76, 175, 80, 0.15)';
        this.style.zIndex = 2;
      });
      box.addEventListener('mouseleave', function() {
        this.querySelector('.charity-hover-details').style.display = 'none';
        this.style.boxShadow = '';
        this.style.zIndex = '';
      });
    });

    // Real-time stats simulation (Donations/Volunteers since online)
    const stats = [
      { label: "Donations since you've been online", value: 0 },
      { label: "Volunteers since you've been online", value: 0 }
    ];
    function updateStats() {
      stats[0].value += Math.floor(Math.random() * 3 + 1);
      stats[1].value += Math.floor(Math.random() * 1 + 1);
      document.getElementById('realtime-stats').innerHTML =
        stats.map(s => `<strong>${s.label}:</strong> ${s.value.toLocaleString()}`).join(' &nbsp;|&nbsp; ');
    }
    updateStats();
    setInterval(updateStats, 4000);

    // ProPublica Non-profit Explorer API integration (minimal, user-friendly)
    (function() {
      const gridSection = document.querySelector('.charity-grid');
      if (!gridSection) return;
      let propublicaSection = document.getElementById('propublica-nonprofits');
      if (!propublicaSection) {
        propublicaSection = document.createElement('section');
        propublicaSection.id = 'propublica-nonprofits';
        propublicaSection.style.margin = "40px auto 0 auto";
        propublicaSection.style.maxWidth = "1100px";
        propublicaSection.innerHTML = `
          <h2 style="color:#4a7c59;text-align:center;margin-bottom:18px;">Search U.S. Nonprofits</h2>
          <form id="propublica-search-form" style="display:flex;justify-content:center;gap:0 10px;margin-bottom:18px;">
            <input type="text" id="propublica-search" placeholder="Search by name, keyword, or EIN" style="padding:10px;width:260px;max-width:90%;border-radius:4px 0 0 4px;border:1px solid #ddd;font-size:1em;">
            <button type="submit" style="padding:10px 18px;background:#4a7c59;color:#fff;border:none;border-radius:0 4px 4px 0;font-weight:600;cursor:pointer;">Search</button>
          </form>
          <div id="propublica-results" style="display:flex;flex-wrap:wrap;gap:24px;justify-content:center;"></div>
        `;
        gridSection.parentNode.insertBefore(propublicaSection, gridSection.nextSibling);
      }

      const form = document.getElementById('propublica-search-form');
      const input = document.getElementById('propublica-search');
      const results = document.getElementById('propublica-results');

      // Helper: Format currency
      function formatCurrency(num) {
        if (!num || isNaN(num)) return 'N/A';
        return '$' + Number(num).toLocaleString();
      }
      // Helper: Format percent
      function formatPercent(num) {
        if (!num || isNaN(num)) return 'N/A';
        return Number(num).toFixed(1) + '%';
      }
      // Helper: NTEE code to description (partial, fallback to code)
      function nteeDesc(code) {
        const map = {
          'B': 'Education', 'C': 'Environment', 'D': 'Animal', 'E': 'Health', 'F': 'Mental Health',
          'G': 'Diseases', 'H': 'Medical Research', 'I': 'Crime', 'J': 'Employment', 'K': 'Food',
          'L': 'Housing', 'M': 'Public Safety', 'N': 'Recreation', 'O': 'Youth', 'P': 'Human Services',
          'Q': 'International', 'R': 'Civil Rights', 'S': 'Community', 'T': 'Philanthropy',
          'U': 'Science', 'V': 'Social Science', 'W': 'Public Benefit', 'X': 'Religion', 'Y': 'Mutual/Membership', 'Z': 'Unknown'
        };
        if (!code) return '';
        const letter = code[0];
        return map[letter] ? map[letter] + ' (' + code + ')' : code;
      }

      form.addEventListener('submit', function(e) {
        e.preventDefault();
        const query = (input.value || '').trim();
        if (!query) return;
        results.innerHTML = '<div style="color:#888;text-align:center;width:100%;">Searching nonprofits...</div>';
        // Use AllOrigins proxy to bypass CORS
        const propublicaUrl = `https://projects.propublica.org/nonprofits/api/v2/search.json?q=${encodeURIComponent(query)}`;
        const allOriginsUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(propublicaUrl)}`;
        fetch(allOriginsUrl)
          .then(res => res.ok ? res.json() : Promise.reject())
          .then(data => {
            let orgs = [];
            try {
              const parsed = JSON.parse(data.contents);
              orgs = (parsed && parsed.organizations) || [];
            } catch (err) {
              results.innerHTML = '<div style="color:#d32f2f;text-align:center;width:100%;">Unable to parse nonprofit data.</div>';
              return;
            }
            if (!orgs.length) {
              results.innerHTML = '<div style="color:#888;text-align:center;width:100%;">No nonprofits found for your search.</div>';
              return;
            }
            results.innerHTML = '';
            orgs.slice(0, 6).forEach(org => {
              const ein = org.ein || '';
              const name = org.name || '';
              const city = org.city || '';
              const state = org.state || '';
              const ntee = org.ntee_code || '';
              const subsection = org.subsection_code || '';
              const ruling = org.ruling_year || '';
              const profileUrl = `https://projects.propublica.org/nonprofits/organizations/${ein}`;
              // Program Expense % and Revenue (from latest990)
              let progPct = null, revenue = null;
              if (org.latest990) {
                progPct = org.latest990.pct_program || null;
                revenue = org.latest990.total_revenue || null;
              }
              // IRS Status badge
              const irsBadge = subsection
                ? `<span style="display:inline-block;background:#e6f4ea;color:#256029;font-weight:600;padding:2px 8px;border-radius:12px;font-size:0.93em;margin-left:4px;">501(c)${subsection}</span>`
                : '';
              // Cause badge
              const causeBadge = ntee
                ? `<span style="display:inline-block;background:#f2e3bc;color:#4a7c59;font-weight:600;padding:2px 8px;border-radius:12px;font-size:0.93em;margin-left:4px;">${nteeDesc(ntee)}</span>`
                : '';
              // Program Expense badge
              const progBadge = progPct !== null
                ? `<span style="display:inline-block;background:#d9f9e6;color:#256029;font-weight:600;padding:2px 8px;border-radius:12px;font-size:0.93em;margin-left:4px;">Program: ${formatPercent(progPct)}</span>`
                : '';
              // Revenue badge
              const revBadge = revenue !== null
                ? `<span style="display:inline-block;background:#e3eafc;color:#1a237e;font-weight:600;padding:2px 8px;border-radius:12px;font-size:0.93em;margin-left:4px;">Revenue: ${formatCurrency(revenue)}</span>`
                : '';
              // Card HTML
              const card = document.createElement('div');
              card.style.cssText = 'background:#fff;border:1px solid #e0e0e0;border-radius:8px;box-shadow:0 2px 8px rgba(76,175,80,0.07);padding:16px 14px;width:290px;min-height:120px;display:flex;flex-direction:column;justify-content:space-between;';
              card.innerHTML = `
                <div>
                  <div style="font-size:1.08em;font-weight:700;margin-bottom:4px;color:#3a6351;">
                    ${name}
                    <span style="font-size:0.97em;font-weight:400;color:#555;margin-left:6px;">${city}${state ? ', ' + state : ''}</span>
                  </div>
                  <div style="margin:8px 0 8px 0;">
                    ${causeBadge}
                    ${progBadge}
                    ${revBadge}
                    ${irsBadge}
                  </div>
                  <div style="color:#888;font-size:0.96em;">EIN: ${ein}</div>
                  <div style="color:#888;font-size:0.96em;">Ruling Year: ${ruling || 'N/A'}</div>
                </div>
                <a href="${profileUrl}" target="_blank" rel="noopener" style="margin-top:12px;display:inline-block;background:#4a7c59;color:#fff;padding:7px 14px;border-radius:4px;text-decoration:none;font-weight:600;font-size:0.98em;">View Full Profile</a>
              `;
              results.appendChild(card);
            });
          })
          .catch(() => {
            results.innerHTML = '<div style="color:#d32f2f;text-align:center;width:100%;">Unable to load nonprofit data at this time. Please try again later.</div>';
          });
      });
    })();
  </script>
</body>
</html>
